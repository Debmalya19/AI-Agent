<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Functionality Test Suite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/modern-dashboard.css">
    <style>
        .test-container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .test-pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .progress-container {
            margin: 20px 0;
        }
        .test-summary {
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>Admin Dashboard Functionality Test Suite</h1>
        <p>This test suite validates interactive elements, JavaScript functionality, and user interface components across all dashboard pages.</p>
        
        <div class="test-summary" id="testSummary">
            <h3>Test Summary</h3>
            <div class="row">
                <div class="col-md-3">
                    <strong>Total Tests:</strong> <span id="totalTests">0</span>
                </div>
                <div class="col-md-3">
                    <strong>Passed:</strong> <span id="passedTests" class="text-success">0</span>
                </div>
                <div class="col-md-3">
                    <strong>Failed:</strong> <span id="failedTests" class="text-danger">0</span>
                </div>
                <div class="col-md-3">
                    <strong>Score:</strong> <span id="overallScore">0%</span>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress">
                    <div class="progress-bar" id="progressBar" role="progressbar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <div class="mb-3">
            <button class="btn btn-primary" onclick="runAllTests()">Run All Tests</button>
            <button class="btn btn-secondary" onclick="clearResults()">Clear Results</button>
            <button class="btn btn-info" onclick="exportResults()">Export Results</button>
        </div>

        <div class="test-section">
            <h3>CSS and Styling Tests</h3>
            <div id="cssTests"></div>
        </div>

        <div class="test-section">
            <h3>JavaScript Functionality Tests</h3>
            <div id="jsTests"></div>
        </div>

        <div class="test-section">
            <h3>Interactive Elements Tests</h3>
            <div id="interactiveTests"></div>
        </div>

        <div class="test-section">
            <h3>Navigation Tests</h3>
            <div id="navigationTests"></div>
        </div>

        <div class="test-section">
            <h3>Responsive Design Tests</h3>
            <div id="responsiveTests"></div>
        </div>

        <div class="test-section">
            <h3>Error Handling Tests</h3>
            <div id="errorHandlingTests"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        class DashboardFunctionalityTester {
            constructor() {
                this.testResults = [];
                this.totalTests = 0;
                this.passedTests = 0;
                this.failedTests = 0;
                this.pages = [
                    'index.html',
                    'tickets.html',
                    'users.html',
                    'integration.html',
                    'settings.html',
                    'logs.html'
                ];
            }

            addTestResult(category, testName, passed, message = '') {
                const result = {
                    category,
                    testName,
                    passed,
                    message,
                    timestamp: new Date().toISOString()
                };
                
                this.testResults.push(result);
                this.totalTests++;
                
                if (passed) {
                    this.passedTests++;
                } else {
                    this.failedTests++;
                }
                
                this.displayTestResult(category, result);
                this.updateSummary();
            }

            displayTestResult(category, result) {
                const container = document.getElementById(category + 'Tests');
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${result.passed ? 'test-pass' : 'test-fail'}`;
                
                const icon = result.passed ? '✅' : '❌';
                resultDiv.innerHTML = `
                    <strong>${icon} ${result.testName}</strong>
                    ${result.message ? `<br><small>${result.message}</small>` : ''}
                `;
                
                container.appendChild(resultDiv);
            }

            updateSummary() {
                document.getElementById('totalTests').textContent = this.totalTests;
                document.getElementById('passedTests').textContent = this.passedTests;
                document.getElementById('failedTests').textContent = this.failedTests;
                
                const score = this.totalTests > 0 ? Math.round((this.passedTests / this.totalTests) * 100) : 0;
                document.getElementById('overallScore').textContent = score + '%';
                
                const progressBar = document.getElementById('progressBar');
                progressBar.style.width = score + '%';
                progressBar.className = `progress-bar ${score >= 80 ? 'bg-success' : score >= 60 ? 'bg-warning' : 'bg-danger'}`;
            }

            testCSSAndStyling() {
                console.log('Testing CSS and Styling...');
                
                // Test if modern-dashboard.css is loaded
                const stylesheets = Array.from(document.styleSheets);
                const hasModernCSS = stylesheets.some(sheet => {
                    try {
                        return sheet.href && sheet.href.includes('modern-dashboard.css');
                    } catch (e) {
                        return false;
                    }
                });
                
                this.addTestResult('css', 'Modern Dashboard CSS Loaded', hasModernCSS, 
                    hasModernCSS ? 'modern-dashboard.css is properly loaded' : 'modern-dashboard.css not found');

                // Test Bootstrap CSS
                const hasBootstrap = stylesheets.some(sheet => {
                    try {
                        return sheet.href && sheet.href.includes('bootstrap');
                    } catch (e) {
                        return false;
                    }
                });
                
                this.addTestResult('css', 'Bootstrap CSS Loaded', hasBootstrap,
                    hasBootstrap ? 'Bootstrap CSS is loaded' : 'Bootstrap CSS not found');

                // Test common CSS classes
                const commonClasses = ['btn', 'card', 'table', 'form-control', 'sidebar', 'navbar'];
                let classesFound = 0;
                
                commonClasses.forEach(className => {
                    const elements = document.getElementsByClassName(className);
                    if (elements.length > 0) {
                        classesFound++;
                    }
                });
                
                const classTestPassed = classesFound >= commonClasses.length * 0.5;
                this.addTestResult('css', 'Common CSS Classes Present', classTestPassed,
                    `Found ${classesFound}/${commonClasses.length} common CSS classes`);

                // Test responsive viewport meta tag
                const viewportMeta = document.querySelector('meta[name="viewport"]');
                this.addTestResult('css', 'Responsive Viewport Meta Tag', !!viewportMeta,
                    viewportMeta ? 'Viewport meta tag is present' : 'Viewport meta tag missing');
            }

            testJavaScriptFunctionality() {
                console.log('Testing JavaScript Functionality...');
                
                // Test if jQuery is available (if used)
                const hasjQuery = typeof $ !== 'undefined';
                this.addTestResult('js', 'jQuery Available', hasjQuery || true, // Not required
                    hasjQuery ? 'jQuery is loaded' : 'jQuery not loaded (may not be required)');

                // Test if Bootstrap JS is loaded
                const hasBootstrapJS = typeof bootstrap !== 'undefined';
                this.addTestResult('js', 'Bootstrap JS Loaded', hasBootstrapJS,
                    hasBootstrapJS ? 'Bootstrap JavaScript is loaded' : 'Bootstrap JS not found');

                // Test for common dashboard functions
                const commonFunctions = ['showLoading', 'hideLoading', 'showAlert', 'showSuccess', 'showError'];
                let functionsFound = 0;
                
                commonFunctions.forEach(funcName => {
                    if (typeof window[funcName] === 'function') {
                        functionsFound++;
                    }
                });
                
                this.addTestResult('js', 'Common Dashboard Functions', functionsFound > 0,
                    `Found ${functionsFound}/${commonFunctions.length} common functions`);

                // Test API connectivity (if unifiedApi is available)
                const hasUnifiedAPI = typeof unifiedApi !== 'undefined';
                this.addTestResult('js', 'Unified API Available', hasUnifiedAPI,
                    hasUnifiedAPI ? 'Unified API object is available' : 'Unified API not found');

                // Test local storage functionality
                try {
                    localStorage.setItem('test', 'value');
                    const testValue = localStorage.getItem('test');
                    localStorage.removeItem('test');
                    this.addTestResult('js', 'Local Storage Functional', testValue === 'value',
                        'Local storage read/write operations work');
                } catch (e) {
                    this.addTestResult('js', 'Local Storage Functional', false,
                        'Local storage not available: ' + e.message);
                }
            }

            testInteractiveElements() {
                console.log('Testing Interactive Elements...');
                
                // Test buttons
                const buttons = document.querySelectorAll('button, .btn, input[type="button"], input[type="submit"]');
                this.addTestResult('interactive', 'Buttons Present', buttons.length > 0,
                    `Found ${buttons.length} interactive buttons`);

                // Test forms
                const forms = document.querySelectorAll('form');
                this.addTestResult('interactive', 'Forms Present', forms.length >= 0,
                    `Found ${forms.length} forms`);

                // Test modals
                const modals = document.querySelectorAll('.modal, [data-bs-toggle="modal"]');
                this.addTestResult('interactive', 'Modals Present', modals.length >= 0,
                    `Found ${modals.length} modal elements`);

                // Test tables
                const tables = document.querySelectorAll('table, .table');
                this.addTestResult('interactive', 'Tables Present', tables.length >= 0,
                    `Found ${tables.length} tables`);

                // Test input fields
                const inputs = document.querySelectorAll('input, select, textarea');
                this.addTestResult('interactive', 'Input Fields Present', inputs.length >= 0,
                    `Found ${inputs.length} input fields`);

                // Test clickable elements have proper cursor
                let clickableElements = 0;
                buttons.forEach(btn => {
                    const style = window.getComputedStyle(btn);
                    if (style.cursor === 'pointer' || btn.tagName.toLowerCase() === 'button') {
                        clickableElements++;
                    }
                });
                
                this.addTestResult('interactive', 'Clickable Elements Styled', clickableElements > 0,
                    `${clickableElements} elements have proper cursor styling`);
            }

            testNavigation() {
                console.log('Testing Navigation...');
                
                // Test sidebar navigation
                const sidebar = document.querySelector('.sidebar, .nav-sidebar, .navigation');
                this.addTestResult('navigation', 'Sidebar Present', !!sidebar,
                    sidebar ? 'Sidebar navigation found' : 'Sidebar navigation not found');

                // Test navigation links
                const navLinks = document.querySelectorAll('.nav-link, .sidebar a, .navbar a');
                this.addTestResult('navigation', 'Navigation Links Present', navLinks.length > 0,
                    `Found ${navLinks.length} navigation links`);

                // Test breadcrumbs
                const breadcrumbs = document.querySelectorAll('.breadcrumb, .breadcrumb-item');
                this.addTestResult('navigation', 'Breadcrumbs Present', breadcrumbs.length >= 0,
                    `Found ${breadcrumbs.length} breadcrumb elements`);

                // Test page title
                const title = document.title;
                this.addTestResult('navigation', 'Page Title Set', title && title.trim().length > 0,
                    title ? `Page title: "${title}"` : 'Page title is empty');

                // Test active navigation states
                const activeNavItems = document.querySelectorAll('.nav-link.active, .active');
                this.addTestResult('navigation', 'Active Navigation States', activeNavItems.length >= 0,
                    `Found ${activeNavItems.length} active navigation items`);
            }

            testResponsiveDesign() {
                console.log('Testing Responsive Design...');
                
                // Test viewport width detection
                const viewportWidth = window.innerWidth;
                this.addTestResult('responsive', 'Viewport Width Detection', viewportWidth > 0,
                    `Current viewport width: ${viewportWidth}px`);

                // Test CSS media queries (basic check)
                const hasMediaQueries = Array.from(document.styleSheets).some(sheet => {
                    try {
                        return Array.from(sheet.cssRules || []).some(rule => 
                            rule.type === CSSRule.MEDIA_RULE
                        );
                    } catch (e) {
                        return false;
                    }
                });
                
                this.addTestResult('responsive', 'Media Queries Present', hasMediaQueries,
                    hasMediaQueries ? 'CSS media queries detected' : 'No media queries found');

                // Test Bootstrap responsive classes
                const responsiveElements = document.querySelectorAll('[class*="col-"], [class*="d-"], [class*="flex-"]');
                this.addTestResult('responsive', 'Responsive Classes Used', responsiveElements.length > 0,
                    `Found ${responsiveElements.length} elements with responsive classes`);

                // Test container elements
                const containers = document.querySelectorAll('.container, .container-fluid, .container-xl');
                this.addTestResult('responsive', 'Container Elements Present', containers.length > 0,
                    `Found ${containers.length} container elements`);
            }

            testErrorHandling() {
                console.log('Testing Error Handling...');
                
                // Test alert elements
                const alerts = document.querySelectorAll('.alert, .notification, .toast');
                this.addTestResult('errorHandling', 'Alert Elements Present', alerts.length >= 0,
                    `Found ${alerts.length} alert/notification elements`);

                // Test loading indicators
                const loadingElements = document.querySelectorAll('.spinner, .loading, .loader, [data-loading]');
                this.addTestResult('errorHandling', 'Loading Indicators Present', loadingElements.length >= 0,
                    `Found ${loadingElements.length} loading indicator elements`);

                // Test error message containers
                const errorContainers = document.querySelectorAll('.error, .alert-danger, .text-danger, [data-error]');
                this.addTestResult('errorHandling', 'Error Message Containers', errorContainers.length >= 0,
                    `Found ${errorContainers.length} error message containers`);

                // Test success message containers
                const successContainers = document.querySelectorAll('.success, .alert-success, .text-success, [data-success]');
                this.addTestResult('errorHandling', 'Success Message Containers', successContainers.length >= 0,
                    `Found ${successContainers.length} success message containers`);

                // Test form validation elements
                const validationElements = document.querySelectorAll('.invalid-feedback, .valid-feedback, .form-text');
                this.addTestResult('errorHandling', 'Form Validation Elements', validationElements.length >= 0,
                    `Found ${validationElements.length} form validation elements`);
            }

            clearResults() {
                this.testResults = [];
                this.totalTests = 0;
                this.passedTests = 0;
                this.failedTests = 0;
                
                // Clear all test result containers
                const containers = ['css', 'js', 'interactive', 'navigation', 'responsive', 'errorHandling'];
                containers.forEach(container => {
                    const element = document.getElementById(container + 'Tests');
                    if (element) {
                        element.innerHTML = '';
                    }
                });
                
                this.updateSummary();
            }

            exportResults() {
                const results = {
                    timestamp: new Date().toISOString(),
                    summary: {
                        totalTests: this.totalTests,
                        passedTests: this.passedTests,
                        failedTests: this.failedTests,
                        score: this.totalTests > 0 ? Math.round((this.passedTests / this.totalTests) * 100) : 0
                    },
                    testResults: this.testResults,
                    userAgent: navigator.userAgent,
                    viewport: {
                        width: window.innerWidth,
                        height: window.innerHeight
                    }
                };
                
                const blob = new Blob([JSON.stringify(results, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `dashboard-functionality-test-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            runAllTests() {
                console.log('Starting comprehensive functionality tests...');
                this.clearResults();
                
                // Add a small delay between test categories for better UX
                setTimeout(() => this.testCSSAndStyling(), 100);
                setTimeout(() => this.testJavaScriptFunctionality(), 200);
                setTimeout(() => this.testInteractiveElements(), 300);
                setTimeout(() => this.testNavigation(), 400);
                setTimeout(() => this.testResponsiveDesign(), 500);
                setTimeout(() => this.testErrorHandling(), 600);
                
                setTimeout(() => {
                    console.log('All tests completed!');
                    const score = this.totalTests > 0 ? Math.round((this.passedTests / this.totalTests) * 100) : 0;
                    
                    let message = '';
                    if (score >= 80) {
                        message = '✅ Dashboard functionality tests PASSED!';
                    } else if (score >= 60) {
                        message = '⚠️ Dashboard functionality tests passed with warnings.';
                    } else {
                        message = '❌ Dashboard functionality tests FAILED.';
                    }
                    
                    alert(`${message}\n\nScore: ${score}%\nPassed: ${this.passedTests}/${this.totalTests} tests`);
                }, 1000);
            }
        }

        // Initialize tester
        const tester = new DashboardFunctionalityTester();

        // Global functions for button clicks
        function runAllTests() {
            tester.runAllTests();
        }

        function clearResults() {
            tester.clearResults();
        }

        function exportResults() {
            tester.exportResults();
        }

        // Auto-run tests when page loads
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dashboard Functionality Tester loaded');
            // Uncomment the next line to auto-run tests on page load
            // setTimeout(() => tester.runAllTests(), 1000);
        });
    </script>
</body>
</html>